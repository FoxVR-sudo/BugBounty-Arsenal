# BugBounty Arsenal V2.0 - Complete Platform Refactor

## ğŸ‰ What's New

### 1. **Docker Integration with Go Tools**
- âœ… Multi-stage Dockerfile with ProjectDiscovery tools pre-installed
- âœ… Subfinder, HTTPX, Nuclei bundled server-side
- âœ… No user installation required - works on online platform
- âœ… Docker Compose for easy deployment

### 2. **Comprehensive Admin Panel**
Full platform control at `/admin`:
- ğŸ‘¥ **User Management** - View, edit, delete, suspend users
- ğŸ’³ **Plan Management** - Create, edit, delete subscription plans (CRUD)
- ğŸ” **Scan Management** - Monitor all scans, delete stuck scans
- ğŸ“§ **Email Logs** - View all sent emails and delivery status
- ğŸ“ **Audit Logs** - Complete security event tracking
- ğŸ’¾ **Database Tools** - Backup, restore, view stats
- âš™ï¸ **Platform Settings** - Global configuration

**Access**: Only users with `is_admin=True` can access admin panel

### 3. **Dynamic Plan System**
- âœ… Plans stored in database (not hardcoded)
- âœ… FREE and PRO plans with JSON limits/features
- âœ… Admin can add/edit/delete plans
- âœ… `subscription_new.py` with Plan model integration
- âœ… Legacy `subscription.py` kept for backward compatibility

#### Plan Structure
```json
{
  "name": "PRO",
  "display_name": "Pro Plan",
  "price_monthly": 49.99,
  "limits": {
    "scans_per_day": -1,  // -1 = unlimited
    "max_concurrent_scans": 5,
    "recon_mode": true,
    "advanced_detectors": true
  },
  "features": [
    "Unlimited scans",
    "All 22+ detectors",
    "Reconnaissance mode"
  ]
}
```

### 4. **Simplified Tiers**
- âŒ Removed: BASIC, ENTERPRISE
- âœ… Active: **FREE** and **PRO** only
- Migration script upgrades all paid users to PRO

### 5. **Admin Authentication**
- New `is_admin` field in User model
- `@require_admin` decorator protects all `/admin/*` routes
- Session-based admin verification
- Audit log for all admin actions

### 6. **Sidebar Navigation (Planned)**
5 scan categories for better UX:
1. ğŸ” **Reconnaissance** - Subdomain enumeration
2. ğŸŒ **Web Security** - XSS, SQLi, CSRF
3. âš ï¸ **Vulnerability Scan** - CVE scanning, Nuclei
4. ğŸ”Œ **API Security** - GraphQL, REST, JWT
5. ğŸ“± **Mobile Security** - Mobile app scanning (future)

See `SIDEBAR_IMPLEMENTATION_PLAN.md` for details.

---

## ğŸš€ Quick Start

### Option 1: Docker (Recommended)
```bash
# Build and start
docker-compose up --build

# Access
http://localhost:5000
```

### Option 2: Local Development
```bash
# Install dependencies
pip install -r requirements.txt

# Run migration
python migrate_to_v2.py

# Initialize plans
python init_plans.py

# Start server
python -m uvicorn webapp:app --host 0.0.0.0 --port 5000
```

---

## ğŸ“‹ Migration Guide

### From V1 to V2
```bash
# 1. Backup database
cp bugbounty_arsenal.db bugbounty_arsenal_backup.db

# 2. Run migration
python migrate_to_v2.py

# 3. Make first user admin (optional)
sqlite3 bugbounty_arsenal.db "UPDATE users SET is_admin=1 WHERE id=1;"

# 4. Restart application
```

### Migration Changes
- âœ… Adds `is_admin` column to `users`
- âœ… Adds `plan_id` column to `subscriptions`
- âœ… Creates `plans` table
- âœ… Seeds FREE and PRO plans
- âœ… Migrates existing subscriptions to new plans
- âœ… Creates first admin user

---

## ğŸ›¡ï¸ Admin Panel

### Access
1. Log in as admin user (`is_admin=True`)
2. Click **"ğŸ›¡ï¸ Admin Panel"** button in dashboard
3. Navigate to `/admin`

### Features

#### User Management (`/admin/api/users`)
- **GET** `/admin/api/users` - List all users
- **GET** `/admin/api/users/{id}` - User details
- **POST** `/admin/api/users` - Create user
- **PUT** `/admin/api/users/{id}` - Update user
- **DELETE** `/admin/api/users/{id}` - Delete user

#### Plan Management (`/admin/api/plans`)
- **GET** `/admin/api/plans` - List all plans
- **POST** `/admin/api/plans` - Create plan
- **PUT** `/admin/api/plans/{id}` - Update plan
- **DELETE** `/admin/api/plans/{id}` - Delete plan (if no subscribers)

#### Scan Management (`/admin/api/scans`)
- **GET** `/admin/api/scans` - List all scans
- **DELETE** `/admin/api/scans/{id}` - Delete scan + files

#### Audit Logs (`/admin/api/audit-logs`)
- **GET** `/admin/api/audit-logs` - View all security events

#### Database Tools (`/admin/api/database`)
- **GET** `/admin/api/database/info` - Database stats
- **POST** `/admin/api/database/backup` - Create backup
- **GET** `/admin/api/database/backups` - List backups

---

## ğŸ³ Docker Setup

### Dockerfile Structure
```dockerfile
# Stage 1: Build Go tools
FROM golang:1.21-alpine AS go-builder
RUN go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
RUN go install github.com/projectdiscovery/httpx/cmd/httpx@latest
RUN go install github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest

# Stage 2: Python app
FROM python:3.11-slim
COPY --from=go-builder /go/bin/* /usr/local/bin/
COPY . /app
RUN pip install -r requirements.txt
CMD ["uvicorn", "webapp:app", "--host", "0.0.0.0", "--port", "5000"]
```

### docker-compose.yml
```yaml
services:
  web:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./bugbounty_arsenal.db:/app/bugbounty_arsenal.db
      - ./reports:/app/reports
      - ./scan_progress:/app/scan_progress
    environment:
      - SECRET_KEY=${SECRET_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
```

---

## ğŸ“Š Database Schema Changes

### New Models

#### Plan Model
```python
class Plan(Base):
    id: int
    name: str  # "FREE", "PRO"
    display_name: str
    price_monthly: float
    price_yearly: float
    limits: Text  # JSON string
    features: Text  # JSON array
    is_active: bool
    stripe_price_id_monthly: str
    stripe_price_id_yearly: str
```

#### Updated Models
- `User.is_admin` - Admin panel access
- `Subscription.plan_id` - Foreign key to Plan

---

## ğŸ” Security

### Admin Panel Protection
```python
@require_admin
async def admin_endpoint():
    # Only accessible by is_admin=True users
    pass
```

### Audit Logging
All admin actions logged:
- User creation/deletion
- Plan modifications
- Scan deletions
- Database backups
- Settings changes

---

## ğŸ¯ Roadmap

### Completed âœ…
- Docker integration with Go tools
- Comprehensive admin panel
- Dynamic plan system
- FREE/PRO tier simplification
- Admin authentication
- Migration script

### In Progress ğŸš§
- Sidebar navigation with 5 categories
- Dashboard UI redesign

### Planned ğŸ“‹
- Mobile app scanning
- Team collaboration features
- Scheduled scans
- Advanced rate limiting
- API key management
- Stripe webhook integration
- Email notification system

---

## ğŸ“ API Endpoints

### Admin Routes
```
GET    /admin                      # Admin panel UI
GET    /admin/api/stats            # Dashboard stats
GET    /admin/api/users            # List users
POST   /admin/api/users            # Create user
PUT    /admin/api/users/{id}       # Update user
DELETE /admin/api/users/{id}       # Delete user
GET    /admin/api/plans            # List plans
POST   /admin/api/plans            # Create plan
PUT    /admin/api/plans/{id}       # Update plan
DELETE /admin/api/plans/{id}       # Delete plan
GET    /admin/api/scans            # List scans
DELETE /admin/api/scans/{id}       # Delete scan
GET    /admin/api/audit-logs       # View logs
POST   /admin/api/database/backup  # Backup DB
```

---

## ğŸ› ï¸ Development

### Project Structure
```
BugBounty-Arsenal/
â”œâ”€â”€ Dockerfile                 # Multi-stage build
â”œâ”€â”€ docker-compose.yml         # Docker setup
â”œâ”€â”€ models.py                  # SQLAlchemy models
â”œâ”€â”€ webapp.py                  # FastAPI app
â”œâ”€â”€ admin_routes.py            # Admin API
â”œâ”€â”€ subscription_new.py        # Dynamic plans
â”œâ”€â”€ migrate_to_v2.py           # Migration script
â”œâ”€â”€ init_plans.py              # Seed plans
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ admin.html            # Admin panel UI
â”‚   â””â”€â”€ dashboard.html        # User dashboard
â””â”€â”€ tools/
    â”œâ”€â”€ recon_orchestrator.py # Recon pipeline
    â””â”€â”€ external_tools.py     # Tool wrappers
```

### Running Tests
```bash
# Run all tests
pytest

# Run specific test
pytest tests/test_admin_routes.py
```

---

## ğŸ’¡ Tips

### Making a User Admin
```bash
# Via SQLite
sqlite3 bugbounty_arsenal.db "UPDATE users SET is_admin=1 WHERE email='admin@example.com';"

# Via Python
python -c "
from database import SessionLocal
from models import User
db = SessionLocal()
user = db.query(User).filter(User.email=='admin@example.com').first()
user.is_admin = True
db.commit()
"
```

### Creating Custom Plans
1. Log in as admin
2. Go to `/admin`
3. Navigate to "Plans & Billing"
4. Click "Create Plan"
5. Fill in details (JSON format for limits/features)
6. Save

### Backup Database
```bash
# Manual backup
cp bugbounty_arsenal.db backups/bugbounty_arsenal_$(date +%Y%m%d).db

# Or use admin panel
curl -X POST http://localhost:5000/admin/api/database/backup
```

---

## ğŸ†˜ Support

### Common Issues

**1. Admin panel shows 403 Forbidden**
- Make sure user has `is_admin=True` in database

**2. Recon mode not working**
- Run in Docker: `docker-compose up --build`
- Tools are bundled in container

**3. Plans not showing**
- Run: `python init_plans.py`

**4. Migration fails**
- Backup database first
- Check console output for specific error
- Restore backup if needed

---

## ğŸ“„ License
MIT License - see LICENSE file

## ğŸ¤ Contributing
See CONTRIBUTING.md

---

**Built with â¤ï¸ for the bug bounty community**
